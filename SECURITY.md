# セキュリティ対策について

## 実装済みのセキュリティ対策

### 1. 認証
- **Supabase認証**: ユーザー認証はSupabaseで管理されており、安全な認証システムを使用しています
- **フロントエンド認証チェック**: アプリケーションは認証状態を確認し、未認証ユーザーはアクセスできません

### 2. 入力値検証
- **コンテンツ長制限**: 日記の内容は最大10,000文字に制限されています
- **カスタム指示の長さ制限**: カスタム指示は最大500文字に制限されています
- **データ型検証**: APIエンドポイントで適切なデータ型を検証しています
- **Personality値の検証**: 許可された値のみを受け入れます

### 3. CORS設定
- **開発環境**: すべてのオリジンを許可（開発用）
- **本番環境**: 特定のオリジンのみを許可するように設定を変更してください

## 本番環境での推奨設定

### 1. サーバー側認証の追加（推奨）
現在、フロントエンドでのみ認証チェックが行われています。より強固なセキュリティのため、サーバー側でもSupabase JWTトークンを検証することを推奨します。

### 2. CORS設定の変更
`server.ts`のCORS設定を本番環境に合わせて変更してください：

```typescript
app.use(
  cors({
    origin: process.env.ALLOWED_ORIGINS?.split(',') || ['https://yourdomain.com'],
    credentials: true,
  })
);
```

### 3. 環境変数の保護
- APIキーや秘密鍵は環境変数で管理してください（`.env.local`ファイル）
- `.env.local`ファイルはGitにコミットしないでください
- 本番環境では、適切な環境変数管理サービスを使用してください

### 4. HTTPSの使用
本番環境では必ずHTTPSを使用してください。

### 5. レートリミッティング（オプション）
大量のリクエストを防ぐため、`express-rate-limit`などのレートリミッティングミドルウェアの導入を検討してください。

### 6. データベースセキュリティ
- SupabaseのRLS（Row Level Security）ポリシーを適切に設定してください
- 必要に応じて、データベースへの直接アクセスを制限してください

## 注意事項

- 現在の実装は開発環境向けです
- 本番環境にデプロイする前に、上記の推奨設定を確認・実装してください
- 定期的にセキュリティアップデートを確認してください



